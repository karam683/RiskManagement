const childProcess = require('child_process');
const logger = require('./logging');

let cachedDir;

class DependencyHelper {
    static get globalModulesDir() {
        if (!cachedDir) {
            cachedDir = childProcess.execFileSync('npm', ['root', '-g'], { encoding: 'utf8' }).trim();
        }
        return cachedDir;
    }

    static requireGlobal(packageId) {
        try {
            const packagePath = require.resolve(packageId, { paths: [DependencyHelper.globalModulesDir] });
            return require(packagePath);
        } catch (error) {
            // Ignore error.
            logger.debug(`Failed to find module '${packageId}' in ${DependencyHelper.globalModulesDir}: ${error}`);
        }
    }
}

module.exports = DependencyHelper;
